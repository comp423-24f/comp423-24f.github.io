<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> EX01 - Asynchronous I/O - COMP423 - 23S</title>
  <link rel="icon" type="image/png" href="/static/tabbrand.png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/static/styles.css?v=1728661992.5465178">
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg bg-dark navbar-dark py-1 fixed-top">
    <div class="container">
      <a href="/" class="navbar-brand">COMP423</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link " href="/">agenda</a>
          </li>
          <li class="nav-item">
            <a href="/support" class="nav-link">support</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div id="exercises-page" class="container">
    <div class="row pt-4">
      <div class="col-12">
        <h2>EX01 - Asynchronous I/O</h2>
        <hr class="title" />
      </div>
    </div>

    <div class="container">
                <div class="content"><h2 id="introduction">Introduction</h2>
<p>In this exercise, you will build a small command-line interface application in Typescript, running on Node.js, that retrieves data from the public UNC CS Experience Labs’ Web API (Application Programming Interface). Your app will retrieve and present a list of student organization names and “slugs” (URL-safe abbreviations), as well as provide more detailed output about a spefic organization of interest. Making a request to a web API involves <em>network input/output (IO)</em> which is a relatively “slow” process. Thus, the network request will be made asynchronously and your solution will be written to handle the asynchrony.</p>
<p>In this exercise, you will gain exposure to new tools of the trade: linting, automatic source formatting, and testing. Additionally, you will rely on a 3rd party library, axiom, for handling the web requests (as opposed to <code>fetch</code>, as shown in class).</p>
<p>Setting up a complete suite of developer tools in a DevContainer requires some configuration and tinkering concerns beyond our scope at this point in the course, so we are going to provide a working sample container to begin your work in. Let’s go ahead and clone this repository before giving you a tour around and setting you off on your way!</p>
<h2 id="accept-the-github-classroom-assignment">0. Accept the GitHub Classroom Assignment</h2>
<p>Accept Github Classroom Project via this link: <a href="https://classroom.github.com/a/G7-C73Sl" class="uri">https://classroom.github.com/a/G7-C73Sl</a></p>
<p>After accepting, you will be given a link to your repository. Follow it. Its URL convention is <code>github.com/</code> followed by <code>comp423-24f/ex01-async-io-</code> and your Github Username.</p>
<p>Look for the green Code button and the Local tab. Copy your repository’s URL. Clone it to your machine wherever you’d like. At this point in your CS career, we are hopeful you are able to remember, or search to remind yourself, how to clone a <code>git</code> repository from GitHub. Searches along the lines of “clone git repository from github” should prove fruitful.</p>
<h2 id="open-the-cloned-repositorys-directory-in-a-new-vscode-window">1. Open the cloned repository’s directory in a new VSCode Window</h2>
<p>You will see the project files contain starter files. You will notice a <code>.devcontainer</code> directory already established.</p>
<h2 id="devcontainer---rebuild-and-reopen-in-container">2. DevContainer - Rebuild and Reopen in Container</h2>
<p>Now for the <em>magical</em> step of opening your project in a DevContainer. Open VSCode’s command palette (Shortcut: Command+Shift+P on Mac and Control+Shift+P on Windows) and search for “Reopen in Container.” This step will may take a minute, but it should be faster than when you established your first dev container in class. Why? Because both are based on the same TypeScript image from Microsoft and you already have it downloaded!</p>
<h2 id="after-vscode-reopens-in-the-devcontainers-environment-open-a-terminal">3. After VSCode Reopens in the DevContainer’s Environment, Open a Terminal</h2>
<p>You should be able to open a new terminal and see a prompt that looks like this: <code>node -&gt; /workspaces/$REPO (main)</code>, where <code>$REPO</code> is your GitHub repository’s name.</p>
<p>Congratulations, you have started up a new DevContainer! This <code>bash</code> shell is running inside the container, which has Node.js, TypeScript, and more installed. The <code>/workspace</code> is the working directory your terminal is in, which is where your repository’s files are mounted, and <code>(main)</code> refers to the branch your <code>HEAD</code> is on. This custom shell prompt is one of the niceties that was setup in the container build.</p>
<p>As part of the container setup, dependencies are installed via <code>.devcontainer/devcontainer.json</code>’s <code>"postCreateCommand"</code> running <code>npm install</code>. If this does not complete before components of the VS Code Editor load (such as the test plugin for Jest and Prettier) you may see some red areas in VSCode’s status bar down at its bottom edge. If this is the case, once the automatic startup script has completed, try reloading the window from the command palette.</p>
<p>Open a new Terminal in your DevContainer. Try the following two commands:</p>
<ol type="1">
<li><code>npm test</code> - This runs the project’s unit tests. You should see 1 suite and 3 tests pass.</li>
<li><code>npm run build+start hello world</code> - This builds the project and runs it. You should see the two CLI args <code>hello</code> and <code>world</code> printed in JSON list literal format.</li>
</ol>
<p>If either of these commands failed, try running <code>npm install</code> from a terminal and reloading the complete VSCode Window upon completion. Triple check you are in the DevContainer.</p>
<h2 id="code-tour">4. Code Tour</h2>
<p>Let’s walk through the starter files you are seeing in the repository at a high level. Most you will not need to touch, but you should understand the general purpose of each:</p>
<ol type="1">
<li><p><code>.devcontainer/devcontainer</code> - A lot like the one you setup! However, if you open it you can see that additional customizations to VSCode have been established to automatically install some VSCode Extensions (Prettier for code formatting and Jest for unit tests) and some configuration options. Additionally, after the DevContainer is created we are installing 3rd party code in <code>node_modules</code> via <code>npm install</code>. Lastly, we run a <code>git config</code> command in order to add this project’s workspace as a safe directory.</p></li>
<li><p><code>node_modules</code> - This directory contains all of our project’s 3rd party dependency code.</p></li>
<li><p><code>src/index.ts</code> - This file boostraps execution into our project’s <code>main</code> function. You will notice it imports and calls <code>main</code> from <code>src/main.ts</code> and passes in the system variable <code>process.argv</code>. This variable contains the string arguments the command-line program was created with.</p></li>
<li><p><code>src/main.ts</code> - This file serves as the entry point to our program. You will notice <code>main</code> is defined as <code>async</code>, though it does not yet make use of any <code>await</code> functionality. On the second line, you will notice a peculiar statement. It’s worth pausing to understand it! This is an example of <em>destructuring assignment</em>. The variable on the right-hand side is <code>argv</code> which is a <code>string[]</code>. Notice on the left-hand side it <em>looks like</em> we’re declaring a list literal, but what is actually happening is we are using <em>destructuring assignment</em> syntax. The first two strings in <code>argv</code> are the <code>node</code> binary and the script (e.g. <code>dist/index.js</code>), however our program only cares about the “arguments” that follow, so we are ignoring the first two values in <code>argv</code> and assigning the <em>rest</em> to a new string list named <code>args</code>.</p></li>
<li><p><code>test/main.spec.ts</code> - This file contains unit tests in a behavior-driven style. Notice the significant use of arrow functions! Those are all anonymous function definitions! Notice this reads somewhat like a specification: “describe main: it should not log the program or script from argv”. This is one style of unit test possible in Jest. The value of this style is we can specify our requirements in English and then implement tests which verify they behave as expected. There is more to say about what is going on here, we will be back!</p></li>
<li><p><code>.gitignore</code> - Directories ignored by our <code>git</code> repository because they contain built artifacts (e.g. <code>dist</code> and <code>coverage</code>), 3rd party code (<code>node_modules</code>), or Mac-specific hidden files for Finder (<code>.DS_Store</code>).</p></li>
<li><p><code>.prettierignore</code> - Here, like with <code>.gitignore</code>, we tell Prettier, our automatic code reformatting library, to ignore files in built directories such as <code>dist</code> and <code>node_modules</code>. We only want prettier watching over our <code>src</code> and <code>test</code> directories!</p></li>
<li><p><code>.prettierrc</code> - This file is for additional <code>prettier</code> configuration. Ours has a few rules you can hover over the names of for a descriptin of their impact in VSCode. Prettier will automatically reformat your source code on save to ensure everyone’s spacing standards, and other stylistic concerns, are always consistent. This frees your mind from the tedium of syntax style concerns and helps make everyone’s syntactical styles standard!</p></li>
<li><p><code>babel.config.json</code> - Our test framework, Jest, requires Babel, which is a source-to-source transpiler that can transform (<em>transpile</em>) from certain dialects of JavaScript (e.g. TypeScript) into other dialects. Its usage in this project is beyond your concern, but know it’s just a utility needed for the project’s testing setup.</p></li>
<li><p><code>eslint.config.js</code> - This file contains boilerplate for our code linter, ESLint. The ES is short for <code>ECMA Script</code>, which is the true formal name of the colloqial “JavaScript” programming language. Linters are popular tools for software engineering teams that help ensure everyone uses the same conventions and standards. For example, <code>eslint</code> is what will suggest you use <code>const</code> declarations for variables, instead of <code>let</code>, if your code never reassigns the variable later on.</p></li>
<li><p><code>jest.config.ts</code> - Configuration for our unit testing framework <a href="https://jestjs.io/">Jest</a>, created by developers at Facebook/Meta. Ours simply tells <code>jest</code> which directory to find our test files in: <code>./test</code>.</p></li>
<li><p><code>package-lock.json</code> - Opening this file you will see the <em>many</em> subdependencies needed by our top-level dependencies. In real projects in the Node.js ecosystem, you will quickly learn that lots of dependencies are common. This has its pros and cons, but generally it’s great for such a vibrant ecosystem of free, open source software to be available on a platform.</p></li>
<li><p><code>package.json</code> - This file should look familiar. You will see that we have many new <code>devDependencies</code> related to getting TypeScript, Jest, Prettier, and ESLint all working properly (and together). You will see in <code>scripts</code> there are a number of additional subcommands for working with our project than: <code>test</code> (runs <code>jest</code>), <code>coverage</code> (runs test coverage report), <code>build</code>, <code>start</code>, <code>build+start</code> (builds TypeScript to JavaScipt and starts the program), <code>clean</code> (deletes the <code>dist</code> directory).</p></li>
<li><p><code>tsconfig.json</code> - Configuration settings for TypeScript. Of note, you’ll see in <code>types</code> that both <code>node</code> and <code>jest</code> are added so that TypeScript is aware of the built-in globals of <code>node</code> and <code>jest</code>, along with their type information.</p></li>
</ol>
<h2 id="requirements">5. Requirements</h2>
<p>The expected behavior of your program is as follows:</p>
<ol type="1">
<li>One of two subcommands is expected: <code>list</code> or <code>get</code></li>
<li>If no subcommand is provided, an <code>Error</code> should be thrown with a helpful message. The message will be printed in the handler of <code>index.ts</code></li>
<li>If a subcommand other than <code>list</code> or <code>get</code> is provided, an <code>Error</code> should be thrown with a helpful message, like expectation #2.</li>
<li>For the <code>list</code> subcommand, all organizations in the CSXL API should be printed. The output expected is one <code>($slug) $name</code> per line where <code>$slug</code> is the organization’s slug and <code>$name</code> is its name. You can see the results of this API endpoint here: <a href="https://csxl.unc.edu/api/organizations" class="uri">https://csxl.unc.edu/api/organizations</a>.</li>
<li>For the <code>get</code> subcommand, an additional command-line argument with the <code>slug</code> of the organization is expected. If none is provided, an <code>Error</code> with a helpful message should be raised. If one is provided, you should use the API endpoint here: <a href="https://csxl.unc.edu/api/organizations/$slug" class="uri">https://csxl.unc.edu/api/organizations/$slug</a> replacing the last URL part with the slug. For example: <a href="https://csxl.unc.edu/api/organizations/unc-cs" class="uri">https://csxl.unc.edu/api/organizations/unc-cs</a>. The result of this subcommand is showing the <code>name</code>, <code>description</code>, <code>website</code>, and <code>instagram</code> of the student organization. Should a slug not exist and the API results in an error, your program should raise a custom <code>Error</code> with a helpful message.</li>
<li>Reach 100% test coverage with <code>npm run coverage</code>. Use a console spy for detecting output. Mock <code>axios</code> for HTTP requests. More on this in an upcoming section.</li>
</ol>
<h2 id="starting-with-command-line-arguments">6. Starting with Command-Line Arguments</h2>
<p>To help you get started, we will provide some guidance on cleaning up your <code>main</code> function and corresponding tests.</p>
<p>Go ahead and replace the logic in your program’s <code>main</code> function with the following:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>export const main <span class="op">=</span> <span class="fu">async</span> (argv<span class="op">:</span> <span class="dt">string</span>[]) <span class="kw">=&gt;</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  const [<span class="op">,</span> <span class="op">,</span> <span class="op">...</span>args] <span class="op">=</span> argv<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  <span class="fu">if</span> (args<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    throw <span class="kw">new</span> <span class="fu">Error</span>(<span class="st">&quot;No subcommand provided. Expecting &#39;list&#39; or &#39;get&#39;.&quot;</span>)<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>  } else {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(args)<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>  }</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre></div>
<p>For an explanation of the <code>const</code> assignment line, see <strong>Code Tour</strong> part 4 above.</p>
<p>The <code>args</code> variable is a <code>string[]</code> that contains arguments given to the script following <code>node</code> and the <code>index.js</code> script. You can try building and running your program with the following examples to see the behavior. The lines prefixed with a <code>$</code> should be run at your DevContainer’s shell prompt:</p>
<pre class="plaintext"><code>$ npm run build
$ npm start
No subcommand provided. Expecting &#39;list&#39; or &#39;get&#39;.
$ npm start list
[ &#39;list&#39; ]
$ npm start get csxl
[ &#39;get&#39;, &#39;csxl&#39; ]</code></pre>
<p>Notice after builting, <code>npm start</code>, which runs your build program, is reasonably fast at testing out various command-line arguments. However, testing in this way is not automated. Let’s add some automated tests and demonstrate how code coverage with tests works.</p>
<p>Open <code>test/main.spec.ts</code> and add replace the existing tests with a single test for covering the <code>throw</code> branch:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="im">import</span> { main } from <span class="st">&quot;../src/main&quot;</span><span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="fu">describe</span>(<span class="st">&quot;main&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>  <span class="fu">it</span>(<span class="st">&quot;should raise an error if called without args&quot;</span><span class="op">,</span> <span class="fu">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>    await <span class="fu">expect</span>(() <span class="kw">=&gt;</span> <span class="fu">main</span>([<span class="st">&quot;node&quot;</span><span class="op">,</span> <span class="st">&quot;script.js&quot;</span>]))<span class="op">.</span><span class="at">rejects</span><span class="op">.</span><span class="fu">toThrow</span>()<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>  })<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>})<span class="op">;</span></span></code></pre></div>
<p>Consider this structure. We are establishing a test suite for <code>main</code>, which is imported from our source code. We add a single test describing an expected behavior. This style of test description is idiomatic because test cases read as “main should raise an error…”.</p>
<p>The <code>expect</code> function call is forming an <em>assertion</em> of sorts. This usage of <code>expect</code> is interesting because <code>main</code> is an <code>async</code> function, meaning it returns a <code>Promise</code>. When calling functions that return <code>Promise</code> values, the call is placed inside of an anonymous arrow function definition. Notice this is the very terse usage of arrow syntax and equivalent to writing <code>() =&gt; { return main["node", "script.js"] }</code>. Doing so allows <code>jest</code> to wait for the promise to <code>resolve</code> or <code>reject</code> and gives you a nice API for determining the result. In this case, we expect the <code>Promise</code> to <code>reject</code> because an <code>Error</code> is thrown. Hence the <code>expect(...).reject.toThrow()</code>.</p>
<p>Try running this test with <code>npm test</code>, which, in turn, runs <code>jest</code>, our project’s unit testing framework. You should see output as follows:</p>
<pre class="plaintext"><code> PASS  test/main.spec.ts
  main
    ✓ should raise an error if called without args (10 ms)

Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        1.339 s, estimated 2 s
Ran all test suites.</code></pre>
<h3 id="introducing-test-coverage">Introducing Test Coverage</h3>
<p>Now, this tells you <em>all of your tests passed</em>, but it does not give you any assurance of your program being fully tested. Notice there is an entire branch which is untested: the <code>else</code> branch. Luckily, we have tooling to show us whether our code has full test coverage. Try the following command: <code>npm run coverage</code>. This runs <code>jest</code> with the <code>--coverage</code> option enabled. You should see output like follows:</p>
<pre class="plaintext"><code>&gt; jest --coverage

 PASS  test/main.spec.ts
  main
    ✓ should raise an error if called without args (12 ms)

----------|---------|----------|---------|---------|-------------------
File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
----------|---------|----------|---------|---------|-------------------
All files |      80 |       50 |     100 |      80 |                   
 main.ts  |      80 |       50 |     100 |      80 | 11                
----------|---------|----------|---------|---------|-------------------
Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        1.523 s, estimated 2 s
Ran all test suites.</code></pre>
<p>Notice on <em>branches</em>, e.g. conditional <code>if</code>/<code>else</code>, the tool is telling you your tests cover <strong>50%</strong> of branches and <strong>80%</strong> of statements/lines (long lines can make single statements). In <code>main.ts</code>, notice it even tells you <em>which line(s)</em> are uncovered by your tests: line <strong>11</strong>. This corresponds to the <code>console.log(args)</code> line.</p>
<p>Let’s try adding another test for coverage of this line. <em>Note: you will pretty quickly remove this test, and the accompanying simple behavior, because it is not part of the final program, but following along with this step is instructive in learning how to write tests with coverage for <code>console.log</code> statements.</em></p>
<p>Add the second test, as shown below:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="fu">describe</span>(<span class="st">&quot;main&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>  <span class="co">/** First test should still remain here... elided for write-up purposes. */</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>  <span class="fu">it</span>(<span class="st">&quot;should log the args if called with args&quot;</span><span class="op">,</span> <span class="fu">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>    const logSpy <span class="op">=</span> jest<span class="op">.</span><span class="fu">spyOn</span>(<span class="bu">console</span><span class="op">,</span> <span class="st">&quot;log&quot;</span>)<span class="op">.</span><span class="fu">mockImplementation</span>(() <span class="kw">=&gt;</span> {})<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>    await <span class="fu">main</span>([<span class="st">&quot;node&quot;</span><span class="op">,</span> <span class="st">&quot;script.js&quot;</span><span class="op">,</span> <span class="st">&quot;list&quot;</span>])<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>    <span class="fu">expect</span>(logSpy)<span class="op">.</span><span class="fu">toHaveBeenCalledWith</span>([<span class="st">&quot;list&quot;</span>])<span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>  })<span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>})<span class="op">;</span></span></code></pre></div>
<p>The line defining <code>logSpy</code> is quite fascinating. It’s <em>watching</em>, aka <em>spying on</em> the <code>console</code> object’s <code>log</code> method. This means it’s keeping track of calls to it and its arguments. Additionally, the chained method call is <em>replacing the standard implementation of <code>console.log</code></em> with a <code>mockImplementation</code> that is a no-op: a function literal that does nothing. This prevents the built-in implementation from running and, thus, from sending output to the terminal when <code>console.log</code> is called in your code. Very cool! This is an important unit testing concept called <em>mocking</em> we will explore further.</p>
<p>Now when you run <code>npm test</code>, you should see results for both tests:</p>
<pre class="plaintext"><code> PASS  test/main.spec.ts
  main
    ✓ should raise an error if called without args (15 ms)
    ✓ should log the args if called with args (2 ms)

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total</code></pre>
<p>Additionally, try checking coverage: <code>npm run coverage</code>:</p>
<pre class="plaintext"><code>----------|---------|----------|---------|---------|-------------------
File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
----------|---------|----------|---------|---------|-------------------
All files |     100 |      100 |     100 |     100 |                   
 main.ts  |     100 |      100 |     100 |     100 |                   
----------|---------|----------|---------|---------|-------------------</code></pre>
<p>Woo! 100% coverage! Unfortunately, this program does not satisfy the <em>requirements</em> nor do your <em>tests</em> verify correctness of the requirements. In fact, the test you just added <em>should not be kept</em> because it goes against the expected behavior of your program. It was added only for this purpose of showing you <em>how</em> to test for output logged with <code>console.log</code> using a spy with mocking and to show you how test code coverage works.</p>
<p>Go ahead and make a <code>git</code> commit by adding all of the files you have changed to git’s stage and forming a new <code>commit</code> with a meaningful message of progress (such as “Completed section 6: test coverage”). Push your work to your repository on GitHub.</p>
<h2 id="using-axios-for-typed-web-requests">7. Using <code>axios</code> for Typed Web Requests</h2>
<p>Rather than using the built-in <code>fetch</code> function, as shown in class, we will make use of a very popular (downloaded over 40 million times in the past week!) promise-based HTTP request library called <code>axios</code>. For more detail, see its <a href="https://www.npmjs.com/package/axios">npm page</a>, <a href="https://axios-http.com/">home page</a>, and <a href="https://github.com/axios/axios">git repository</a>. It has two really nice features for us. First, it has a more ergonomic API than <code>fetch</code> and allows us to specify generic types to hint to TypeScript what the shape of the expected results are. Second, it is easy to mock in jest.</p>
<p>The <code>axios</code> library will be needed by our built application, not just in development, so we will save it as a true dependency. Run the following command in your DevContainer:</p>
<p><code>npm install --save axios</code></p>
<p>Notice this changes <code>package.json</code> and <code>package-lock.json</code> with metadata that explicitly establishes this dependency. It also installed the library in <code>node_modules</code>.</p>
<p>We will use only a small portion of the <code>axios</code> API, its <code>get</code> method for “getting” or <em>downloading</em> data from the web via a URL. The <code>get</code> method is <em>generic</em> and returns a promise whose <code>data</code> value is expected to implement the shape of the generic. That’s a lot of lingo, let’s give an example:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="im">import</span> axios from <span class="st">&quot;axios&quot;</span><span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>interface Organization {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>  slug<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>  name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>  short_description<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>  instagram<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>  website<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>}</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a><span class="co">/* Later in the program... in an async function definition like `main`... */</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>try {</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a>  const result <span class="op">=</span> await axios<span class="op">.</span><span class="fu">get</span><span class="op">&lt;</span>Organization[]<span class="op">&gt;</span>(<span class="st">&quot;https://csxl.unc.edu/api/organizations&quot;</span>)<span class="op">;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a>  const organizations<span class="op">:</span> Organization[] <span class="op">=</span> result<span class="op">.</span><span class="at">data</span><span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(organizations[<span class="dv">0</span>]<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true"></a>} catch {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true"></a>  throw <span class="kw">new</span> <span class="fu">Error</span>(<span class="st">&quot;Error loading organizations list.&quot;</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true"></a>}</span></code></pre></div>
<p>Notice we established an <code>interface</code> for <code>Organization</code> that contains properties exposed by the API for each organization.</p>
<p>Then, in the <code>try</code>/<code>catch</code>, we <code>await</code> the result of <code>axios.get()</code> thanks to the <code>Promise</code>-based nature of <code>axios</code>’s implementation. The <code>get</code> method is <em>generic</em> and in the diamond syntax we specify that the expected shape of the response will be a list of organizations. If you open <a href="https://csxl.unc.edu/api/organizations" class="uri">https://csxl.unc.edu/api/organizations</a> in a browser, you will see this is the case. (<strong>PRO TIP</strong>: Install a JSON formatter plugin in your Google Chrome to make viewing API results easier. <a href="https://chromewebstore.google.com/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?pli=1">You can find a popular one named JSON Formatter here</a>.)</p>
<p>The <code>result</code> object will have other HTTP response metadata we will learn about in due time. For now we only care about the <em>data</em> in the response. Notice, importantly, on the following line where the <code>organizations</code> variable is declared, we are able to explicitly type this variable as <code>Organization[]</code> and assign it <code>result.data</code> with type safety. This is thanks to the implementation of the generic <code>get</code> method of <code>axios</code>. The type specified in the diamond syntax informs the type of <code>result.data</code>.</p>
<p>It is worth noting <strong>the generic type specified in <code>get</code> is decided <em>on trust</em> that the API actually actually returns data in this shape.</strong> In the event the API and the generic type disagree, or the API implementation changes shape and returns something of a different type in the future, you will see surprising errors at runtime! This is a concern best addressed with integration testing, outside the scope of this project. For now, trust this API returns this shape (and more!) and will not change while you are working on the project.</p>
<p>You can use the same <code>get</code> method for integrating with the API endpoint that returns a single organization (shared in the requirements), but the generic type will be <code>Organization</code>.</p>
<h2 id="mocking-axios-responses-in-jest-tests">8. Mocking <code>axios</code> Responses in <code>jest</code> Tests</h2>
<p>Your implementation’s dependency on <code>axios</code> needs to be mocked in tests with two primary motivations:</p>
<ol type="1">
<li>We are focused on <em>unit testing</em> in this project, <em>not</em> integration testing. Unit testing requires isolating dependencies from the unit under test.</li>
<li>Mocking “expensive” operations with side effects, such as network input/output, helps ensure unit testing is always fast and predictable. If you are working on the project and don’t have internet access <em>your tests will still run</em> even if the program itself will not in that moment.</li>
</ol>
<p>We are intentionally <em>not</em> providing any suggested structure to your project’s code beyond using the provided <code>main</code> function as your entrypoint. However, we <em>do</em> encourage you to take the opportunity to practice program design techniques for a well factored program, such as those you learned in COMP301. Strive to write a simple, maintainable, structured program.</p>
<p>We will provide the following structural hint toward <code>jest</code> test organization that mocks <code>axios</code> and both spies on and mocks <code>console.log</code> to be a no-op and establishes some test data:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="im">import</span> axios from <span class="st">&quot;axios&quot;</span><span class="op">;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>jest<span class="op">.</span><span class="fu">mock</span>(<span class="st">&quot;axios&quot;</span>)<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>const organizations <span class="op">=</span> [</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>  {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>    slug<span class="op">:</span> <span class="st">&quot;unc-cs&quot;</span><span class="op">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>    name<span class="op">:</span> <span class="st">&quot;Computer Science Department&quot;</span><span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>    short_description<span class="op">:</span> <span class="st">&quot;The Computer Science Department at UNC Chapel Hill.&quot;</span><span class="op">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>    instagram<span class="op">:</span> <span class="st">&quot;https://www.instagram.com/unccompsci/&quot;</span><span class="op">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>    website<span class="op">:</span> <span class="st">&quot;https://cs.unc.edu/&quot;</span><span class="op">,</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>  }<span class="op">,</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>  {</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>    slug<span class="op">:</span> <span class="st">&quot;csxl&quot;</span><span class="op">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a>    name<span class="op">:</span> <span class="st">&quot;CS Experience Labs&quot;</span><span class="op">,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>    short_description<span class="op">:</span> <span class="st">&quot;Student-centered labs for gaining experience in CS.&quot;</span><span class="op">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>    instagram<span class="op">:</span> <span class="st">&quot;unc&quot;</span><span class="op">,</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a>    website<span class="op">:</span> <span class="st">&quot;https://csxl.unc.edu&quot;</span><span class="op">,</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a>  }<span class="op">,</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a>]<span class="op">;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true"></a><span class="fu">describe</span>(<span class="st">&quot;some unit of code under test (e.g. main)&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true"></a>  <span class="co">/* Mocks accessible via closure to before/after hooks and tests.*/</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true"></a>  const mockAxios <span class="op">=</span> axios <span class="im">as</span> jest<span class="op">.</span><span class="at">Mocked</span><span class="op">&lt;</span>typeof axios<span class="op">&gt;;</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true"></a>  let logSpy<span class="op">:</span> jest<span class="op">.</span><span class="at">SpyInstance</span><span class="op">;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true"></a>  <span class="fu">beforeEach</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true"></a>    <span class="co">/* Setup the console spy mocks. */</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true"></a>    logSpy <span class="op">=</span> jest<span class="op">.</span><span class="fu">spyOn</span>(<span class="bu">console</span><span class="op">,</span> <span class="st">&quot;log&quot;</span>)<span class="op">.</span><span class="fu">mockImplementation</span>(() <span class="kw">=&gt;</span> {})<span class="op">;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true"></a>  })<span class="op">;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true"></a>  <span class="fu">afterEach</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true"></a>    <span class="co">/* Reset the state of all mocks. */</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true"></a>    jest<span class="op">.</span><span class="fu">resetAllMocks</span>()<span class="op">;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true"></a>  })<span class="op">;</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true"></a>  <span class="fu">it</span>(<span class="st">&quot;should test something that depends on axios.get...&quot;</span><span class="op">,</span> <span class="fu">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true"></a>    <span class="co">// Here we&#39;re mocking the resolved value of `get` where data is the organizations[] defined in globals </span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true"></a>    mockAxios<span class="op">.</span><span class="at">get</span><span class="op">.</span><span class="fu">mockResolvedValue</span>({ data<span class="op">:</span> organizations })<span class="op">;</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: Call unit of code that depended on axios.get&lt;Organization[]&gt;</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: Test return value of unit of code (or spied expectations)</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true"></a>  })<span class="op">;</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true"></a>  <span class="fu">it</span>(<span class="st">&quot;should raise a nicer error when axios.get FAILS (Promise rejected)...&quot;</span><span class="op">,</span> <span class="fu">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true"></a>    const axiosError <span class="op">=</span> <span class="kw">new</span> <span class="fu">Error</span>(<span class="st">&quot;AXIOS ERROR&quot;</span>)<span class="op">;</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true"></a>    mockAxios<span class="op">.</span><span class="at">get</span><span class="op">.</span><span class="fu">mockRejectedValue</span>(axiosError)<span class="op">;</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true"></a>    await <span class="fu">expect</span>(<span class="fu">async</span> () <span class="kw">=&gt;</span> { </span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true"></a>      <span class="co">/* call unit under test expecting `get` to raise a nicer, human error */</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true"></a>      <span class="co">/* if a function is async, be sure to await its call */</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true"></a>    })<span class="op">.</span><span class="at">rejects</span><span class="op">.</span><span class="at">not</span><span class="op">.</span><span class="fu">toEqual</span>(axiosError)<span class="op">;</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true"></a>  })<span class="op">;</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true"></a>})<span class="op">;</span></span></code></pre></div>
<p>From here you should be off and on your way implementing the requirements in Section #5 and testing all unit(s) in your program. Don’t forget to isolate dependencies of your units under test! Try to write a well factored program with simple unit(s)! Remember: the simpler your units of code, the simpler your unit testing job to verify them is.</p>
</div>
            </div>

    <div class="authors-box bg-light mt-4 py-3 ps-4">
      <span> Contributor(s): Kris Jordan</span>
    </div>
  </div>
  <div class='link-page mt-3 container'>
    <footer>
      <h6 class="text-center align-middle footer-text">&copy; 2024 <a href="https://krisjordan.com">Kris Jordan</a>
        - <a
          href="https://docs.google.com/forms/d/e/1FAIpQLScQMteEvnQpBfGsAYP5TpuqokQenhZUIf8CNvfAUUZEjMCWZQ/viewform?usp=sf_link">Feedback
          Form</a>
        - Made with 💛 in <a href="https://cs.unc.edu/">Chapel Hill</a></h6>
    </footer>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>

  <!-- Load React. -->
  <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</body>

</html>